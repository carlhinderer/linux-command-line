-----------------------------------------------------------
CHAPTER 19 - FILESYSTEMS
-----------------------------------------------------------

- Definitions

    - There are several different meanings of the word 'filesystem':

        1. A specific type of data storate format, like EXT3, EXT4, BTRFS, or XFS.
             Linux supports almost 100 types of filesystems.  Each uses its own metadata
             structures.

        2. The entire Linux hierarchical directory structure starting at the / root 
             directory.

        3. A partition or logical volume formatted with a specific type of filesystem that
             can be mounted on a specified mount point on a Linux filesystem.



- Filesystem Functions

    1. Data storage = A structured place to store and retrieve data (primary purpose)

    2. Namespace = A naming and organizational methodology that provides rules for naming
                     and structuring data

    3. Security Model = A scheme for defining access rights

    4. API = System function calls to manipulate filesystem objects like directories and files

    5. Implementation = The software to implement the above functions



- The Linux Filesystem Hierarchical Standard

    - The Standard

        - The Linux directory structure is well-defined and documented in the Linux FHS
            (Filesystem Hierarchy Standard).   


            /
            Primary hierarchy root and root directory of the entire file system hierarchy.

            /bin
            Essential command binaries that need to be available in single user mode; for 
              all users, e.g., cat, ls, cp.

            /boot
            Boot loader files, e.g., kernels, initrd.

            /dev
            Device files, e.g., /dev/null, /dev/disk0, /dev/sda1, /dev/tty, /dev/random.

            /etc
            Host-specific system-wide configuration files

            /etc/opt
            Configuration files for add-on packages that are stored in /opt.

            /etc/sgml
            Configuration files, such as catalogs, for software that processes SGML.

            /etc/X11
            Configuration files for the X Window System, version 11.

            /etc/xml
            Configuration files, such as catalogs, for software that processes XML.

            /home
            Users' home directories, containing saved files, personal settings, etc.

            /lib 
            Libraries essential for the binaries in /bin and /sbin.

            /lib<qual>
            Alternative format essential libraries. Such directories are optional, but if 
              they exist, they have some requirements.

            /media
            Mount points for removable media such as CD-ROMs (appeared in FHS-2.3 in 2004).

            /mnt
            Temporarily mounted filesystems.

            /opt
            Optional application software packages.

            /proc
            Virtual filesystem providing process and kernel information as files. In Linux, 
              corresponds to a procfs mount. Generally automatically generated and populated 
              by the system, on the fly.

            /root
            Home directory for the root user.

            /run
            Run-time variable data: Information about the running system since last boot, e.g., 
              currently logged-in users and running daemons. Files under this directory must 
              be either removed or truncated at the beginning of the boot process; but this is 
              not necessary on systems that provide this directory as a temporary filesystem (tmpfs).

            /sbin
            Essential system binaries, e.g., fsck, init, route.

            /srv
            Site-specific data served by this system, such as data and scripts for web servers, data 
              offered by FTP servers, and repositories for version control systems 
              (appeared in FHS-2.3 in 2004).

            /sys
            Contains information about devices, drivers, and some kernel features.

            /tmp
            Temporary files (see also /var/tmp). Often not preserved between system reboots, and may 
              be severely size restricted.

            /usr
            Secondary hierarchy for read-only user data; contains the majority of (multi-)user 
              utilities and applications.

            /usr/bin
            Non-essential command binaries (not needed in single user mode); for all users.

            /usr/include
            Standard include files.

            /usr/lib
            Libraries for the binaries in /usr/bin and /usr/sbin.

            /usr/lib<qual>
            Alternative format libraries, e.g. /usr/lib32 for 32-bit libraries on a 64-bit 
              machine (optional).

            /usr/local
            Tertiary hierarchy for local data, specific to this host. Typically has further 
              subdirectories, e.g., bin, lib, share.

            /usr/sbin
            Non-essential system binaries, e.g., daemons for various network-services.

            /usr/share
            Architecture-independent (shared) data.

            /usr/src
            Source code, e.g., the kernel source code with its header files.

            /usr/X11R6
            X Window System, Version 11, Release 6 (up to FHS-2.3, optional).

            /var
            Variable files—files whose content is expected to continually change during normal 
              operation of the system—such as logs, spool files, and temporary e-mail files.

            /var/cache
            Application cache data. Such data are locally generated as a result of time-consuming 
              I/O or calculation. The application must be able to regenerate or restore the data. 
              The cached files can be deleted without loss of data.

            /var/lib
            State information. Persistent data modified by programs as they run, e.g., databases, 
              packaging system metadata, etc.

            /var/lock
            Lock files. Files keeping track of resources currently in use.

            /var/log
            Log files. Various logs.

            /var/mail
            Mailbox files. In some distributions, these files may be located in the deprecated 
              /var/spool/mail.

            /var/opt
            Variable data from add-on packages that are stored in /opt.

            /var/run
            Run-time variable data. This directory contains system information data describing 
              the system since it was booted.  In FHS 3.0, /var/run is replaced by /run; a system 
              should either continue to provide a /var/run directory, or provide a symbolic link 
              from /var/run to /run, for backwards compatibility.

            /var/spool
            Spool for tasks waiting to be processed, e.g., print queues and outgoing mail queue.

            /var/spool/mail
            Deprecated location for users' mailboxes.

            /var/tmp
            Temporary files to be preserved between reboots. 



    - Problem Solving

        - Adhering to the FHS makes problem solving as easy as possible, since many applications
            expect things to be in certain places.

        - Since most Linux utilities are consistent in their use of /etc for config files, the
            config file for a give program is easy to find.


    - Using the Filesystem Incorrectly

        - One example of using the filesystem incorrectly is when a developer installed an 
            application in /var.  The application was crashing, because the /var system was
            full, and the log files (stored in /var/log) could not be appended to.  

          Removing the application and reinstalling it in /opt resolved the problem.


    - Adhering to the Standard

        - As SysAdmins, we often create our own scripts to make our work easier.  When
            we create scripts, they should be stored in /usr/local/bin and any config
            files should be stored in /usr/local/etc.  

          There is also a /var/local directory in which database files for local programs
            can be stored.

        - By always adhering to this standard, it is much easier to remember where things
            are installed when you need to troubleshoot them.



- Linux Unified Directory Structure

    - The Linux filesystem unifies all physical hard drives and partitions into a single
        directory structure starting in the / root directory.   This means there is only
        one single directory tree in which to search for files and programs.

    - This can only work because a filesystem such as /home, /tmp, /var, /opt, or /usr
        can be created on separate physical hard drives.  Even removable drives like USB
        will be mounted onto the root filesystem.



- Filesystem Types

    - Linux supports reading about 100 partition types.  It can create and write to only 
        a few of those.  But it is common to mount filesystems of different types on the
        same root filesystem.


    - The choices available when creating a new filesystem in Fedora are:

            btrfs
            cramfs
            ext2
            ext3
            ext4
            fat
            gfs2
            hfsplus
            minix
            msdos
            ntfs
            reiserfs
            vfat
            xfs



- Mounting

    - The term 'mounting' a filesystem refers back to the early days of computing when a
        tape or removable disk pack would need to be physically mounted on an appropriate
        drive device.


    - A 'mount point' is simply an empty directory, like any other, which is created as
        part of the root filesystem.  So, for example, the home filesystem is mounted on
        the directory /home.  


    - Mounting of filesystems during the startup process is managed by the /etc/fstab 
        (filesystem table) config file.  It is a list of filesystems that are to be mounted,
        their designated mount points, and any options needed.


    - Filesystems are mounted on an eixsting directory using the 'mount' command.  In general,
        any directory used as a mount point should be empty.  However, Linux will not 
        prevent you from mounting a filesystem over a directory that already contains files.



- The Linux ext4 Filesystem

    - Cylinder Groups
    - The inode
    - Journal


- Data Allocation Strategies

    - Data Fragmentation


- Repairing Problems

    - The /etc/fstab File
    - Repairing Damaged Filesystems
    - Finding Lost Files


- Creating a New Filesystem

    - Finding Space
    - Adding a Virtual Hard Drive


- Other Filesystems